<!-- Creator     : groff version 1.20.1 -->
<!-- CreationDate: Mon May 16 14:25:55 2011 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>make-fai-nfsroot</title>

</head>
<body>

<h1 align="center">make-fai-nfsroot</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#RECOVERY">RECOVERY</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#FILES">FILES</a><br>
<a href="#AUTHOR">AUTHOR</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">make-fai-nfsroot
&minus; create the FAI nfsroot directory</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>make-fai-nfsroot</b>
[<i>options</i>]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Create the FAI
nfsroot directory as pointed by $NFSROOT in the config_file.
This directory is necessary for the installation of Debian
on remote clients using the FAI package. The config_file
location is discussed in the OPTIONS below.</p>

<p style="margin-left:11%; margin-top: 1em">The exit code
returned is 0 if all commands to build the root directory
exited successfully and &gt;0 if an error occurs.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;B
BASETGZ</b></p>

<p style="margin-left:22%;">Use specified BASETGZ file as
base.tgz for the nfsroot. This avoids calling debootstrap
and therefore reduces the buildtime for the nfsroot.</p>

<p style="margin-left:11%;"><b>&minus;C CFDIR</b></p>

<p style="margin-left:22%;">Use CFDIR as configuration
directory. Default is /etc/fai. You can also set the
environment variable FAI_ETC_DIR.</p>

<p style="margin-left:11%;"><b>&minus;f config_file</b></p>

<p style="margin-left:22%;">Not supported any more. Use
option &minus;C instead.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;K</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Remove all kernels from NFSROOT. This is the same as
calling aptitude purge ~nlinux-image inside the nfsroot.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;k</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Install additional packages defined in /etc/fai/NFSROOT
into the nfsroot. Also copies all kernels from the nfsroot
to the directory $TFTPROOT.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;p</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Preserve ssh keys. This will preserve the whole .ssh
directory of the root account inside the nfsroot.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;U</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Do not divert update-initramfs during build of the
nfsroot. This will slow down the creation process a bit. Use
it in case of missing initrd inside the nfsroot or when
Ubuntu fails if the diversion exists.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;v</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Create verbose output on stdout.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;h</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Show simple help.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>&minus;r</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>Attempt to recover a previously failed run of this
command.</p> </td></tr>
</table>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">If you do not
use NFS, you may still use the NFSROOT directory as a
staging point for building the base installation
tarball.</p>

<h2>RECOVERY
<a name="RECOVERY"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>CAUTION!</b>
This is an advanced feature. You should be willing to open
up an editor and browse the make-fai-nfsroot code to
understand what each task does and how your use of the
recovery option can be impacted by fiddling around with the
stamp files.</p>

<p style="margin-left:11%; margin-top: 1em">You can call
make-fai-nfsroot with the &rsquo;&minus;r&rsquo; option to
attempt a recovery of a previous run. As tasks are
completed, stamp files are generated in
/var/run/fai/make-fai-nfsroot. As each task is called in
recovery mode, the stamp file is checked. If it exists, the
task is skipped. This will save you much time during your
initial install and debug phase. It is not a very
sophisticated mechanism but it can help you on updating the
nfsroot as well. For example, if you want to update the
kernel that is installed, remove the following stamp files:
install_kernel_nfsroot_stamp, setup_bootp_stamp,
setup_dhcp_stamp.</p>

<p style="margin-left:11%; margin-top: 1em">The order in
which the stamp files are created are as follows: <b><br>
call_debootstrap_stamp</b></p>

<p style="margin-left:22%;">Debootstrap was called
successfully.</p>

<p style="margin-left:11%;"><b>create_base_stamp</b></p>

<p style="margin-left:22%;">Created after successfully
calling debootstrap plus a couple of other tasks.</p>


<p style="margin-left:11%;"><b>upgrade_nfsroot_stamp</b></p>

<p style="margin-left:22%;">The packages in $NFSROOT have
successfully been upgraded with apt.</p>


<p style="margin-left:11%;"><b>add_packages_nfsroot_stamp</b></p>

<p style="margin-left:22%;">New packages have been
installed with apt as specified by the $NFSPACKAGES
environment variable in /etc/fai/fai.conf.</p>


<p style="margin-left:11%;"><b>copy_fai_files_stamp</b></p>

<p style="margin-left:22%;">FAI copies a base of files to
the NFSROOT directory.</p>

<p style="margin-left:11%;"><b>setup_ssh_stamp</b></p>

<p style="margin-left:22%;">The SSH environment is set up.
You could probably remove this stamp alone to refresh your
ssh setup.</p>


<p style="margin-left:11%;"><b>create_nfsroot_stamp</b></p>

<p style="margin-left:22%;">This stamp file is created when
all the preceeding steps have been taken. You have a base
nfsroot directory. All you need now is the kernel and the
BOOTP or DHCP setup.</p>


<p style="margin-left:11%;"><b>install_kernel_nfsroot_stamp</b></p>

<p style="margin-left:22%;">The kernel you specified in
$KERNELPACKAGE has been installed.</p>

<p style="margin-left:11%;"><b>setup_bootp_stamp |
setup_dhcp_stamp</b></p>

<p style="margin-left:22%;">Your kernel was either BOOTP or
DHCP. The appropriate setup has been completed.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>exports</i>(5),
<i>nfsd</i>(8), <i>fai-setup</i>(8)</p>

<p style="margin-left:11%; margin-top: 1em">This program is
part of FAI (Fully Automatic Installation). See the FAI
manual for more information on how to use make-fai-nfsroot.
The FAI homepage is http://fai-project.org.</p>

<h2>FILES
<a name="FILES"></a>
</h2>


<p style="margin-left:11%;"><i>/etc/fai/fai.conf</i></p>

<p style="margin-left:22%;">The FAI configuration file.</p>


<p style="margin-left:11%;"><i>/etc/fai/make-fai-nfsroot.conf</i></p>

<p style="margin-left:22%;">The configuration file for
make-fai-nfsroot.</p>


<p style="margin-left:11%;"><i>/etc/fai/nfsroot-hooks/</i></p>

<p style="margin-left:22%;">Directory containing shell
scripts to be sourced at the end of make-fai-nfsroot for
additional configuration of the nfsroot. Can be changed with
NFSROOT_HOOKS.</p>


<p style="margin-left:11%;"><i>/etc/fai/apt/sources.list</i></p>

<p style="margin-left:22%;">Copy this file to the
NFSROOT.</p>


<p style="margin-left:11%;"><i>/var/run/fai/make-fai-nfsroot/*-stamp</i></p>

<p style="margin-left:22%;">Stamp files used for
recovery.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Thomas Lange
&lt;lange@informatik.uni-koeln.de&gt;</p>
<hr>
</body>
</html>
